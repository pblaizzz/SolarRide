<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Subscription Center - SolarRide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="custom.css">
</head>
<body class="bg-gradient-to-b from-green-50 to-emerald-50">
    <!-- Top Navigation -->
    <div class="bg-white/90 backdrop-blur safe-area-top border-b border-gray-100/50">
        <div class="flex items-center justify-between px-4 py-3">
            <button class="w-10 h-10 flex items-center justify-center" onclick="window.parent.postMessage({type: 'navigate', page: 'me'}, '*')">
                <i class="fas fa-arrow-left text-gray-700"></i>
            </button>
            <h1 class="text-lg font-bold primary-green" style="font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;">Subscription Center</h1>
            <div class="w-10"></div>
        </div>
    </div>

    <!-- Content Area -->
    <div class="pb-6 custom-scrollbar overflow-y-auto" style="height: calc(100vh - 60px);">
        <!-- Current Subscription Status -->
        <div class="mx-4 mt-4 gradient-bg-purple rounded-3xl p-5 card-shadow-lg">
            <div class="flex items-center justify-between mb-3">
                <div>
                    <div class="text-purple-900 font-bold mb-1">Green Energy Member</div>
                    <div class="text-purple-700 text-sm">Active Subscription</div>
                </div>
                <div class="px-3 py-1.5 gradient-bg-yellow text-yellow-900 rounded-full text-xs font-bold">Active</div>
            </div>
            <div class="text-sm text-purple-800 mb-2">
                <i class="fas fa-calendar-check mr-2"></i>Valid until: <span class="font-bold" id="currentExpirationDate">2024-12-31</span>
            </div>
            <button class="w-full bg-white text-purple-700 py-2.5 rounded-2xl font-bold text-sm card-shadow mt-3">
                Manage Subscription
            </button>
        </div>

        <!-- Subscription Plans -->
        <div class="mx-4 mt-6">
            <h2 class="text-xl font-bold primary-green mb-4" style="font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;">Choose Your Plan</h2>
            
            <!-- Monthly Plan -->
            <div class="bg-white rounded-3xl p-5 mb-4 card-shadow-lg border-2 border-gray-200">
                <div class="flex items-center justify-between mb-3">
                    <div>
                        <h3 class="text-lg font-bold primary-green mb-1">Monthly</h3>
                        <p class="text-sm text-gray-500">Pay monthly, cancel anytime</p>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-bold primary-green">€9.99</div>
                        <div class="text-xs text-gray-500">per month</div>
                    </div>
                </div>
                <div class="space-y-2 mb-4">
                    <div class="flex items-center text-sm text-gray-700">
                        <i class="fas fa-check-circle text-green-500 mr-2"></i>
                        <span>Unlimited charging sessions</span>
                    </div>
                    <div class="flex items-center text-sm text-gray-700">
                        <i class="fas fa-check-circle text-green-500 mr-2"></i>
                        <span>15% discount on all stations</span>
                    </div>
                    <div class="flex items-center text-sm text-gray-700">
                        <i class="fas fa-check-circle text-green-500 mr-2"></i>
                        <span>Priority customer support</span>
                    </div>
                    <div class="flex items-center text-sm text-gray-700">
                        <i class="fas fa-check-circle text-green-500 mr-2"></i>
                        <span>Exclusive member benefits</span>
                    </div>
                </div>
            <button class="w-full gradient-bg text-white py-3 rounded-2xl font-bold card-shadow hover:opacity-90 transition-opacity">
                Subscribe Monthly
            </button>
            </div>

            <!-- Quarterly Plan (Recommended) -->
            <div class="bg-white rounded-3xl p-5 mb-4 card-shadow-lg border-2 border-green-500 relative">
                <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-green-500 text-white px-4 py-1 rounded-full text-xs font-bold">
                    MOST POPULAR
                </div>
                <div class="flex items-center justify-between mb-3 mt-2">
                    <div>
                        <h3 class="text-lg font-bold primary-green mb-1">Quarterly</h3>
                        <p class="text-sm text-gray-500">Save 7% with 3-month plan</p>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-bold primary-green">€27.99</div>
                        <div class="text-xs text-gray-500">€9.33/month</div>
                    </div>
                </div>
                <div class="bg-green-50 rounded-xl p-3 mb-4">
                    <div class="text-xs text-green-700 font-medium">
                        <i class="fas fa-gift mr-1"></i>Save €2.98 compared to monthly
                    </div>
                </div>
                <div class="space-y-2 mb-4">
                    <div class="flex items-center text-sm text-gray-700">
                        <i class="fas fa-check-circle text-green-500 mr-2"></i>
                        <span>All Monthly benefits included</span>
                    </div>
                    <div class="flex items-center text-sm text-gray-700">
                        <i class="fas fa-check-circle text-green-500 mr-2"></i>
                        <span>20% discount on all stations</span>
                    </div>
                    <div class="flex items-center text-sm text-gray-700">
                        <i class="fas fa-check-circle text-green-500 mr-2"></i>
                        <span>Free station reservations</span>
                    </div>
                    <div class="flex items-center text-sm text-gray-700">
                        <i class="fas fa-check-circle text-green-500 mr-2"></i>
                        <span>Early access to new features</span>
                    </div>
                </div>
                <button class="w-full gradient-bg text-white py-3 rounded-2xl font-bold card-shadow hover:opacity-90 transition-opacity">
                    Subscribe Quarterly
                </button>
            </div>

            <!-- Annual Plan (Best Value) -->
            <div class="bg-white rounded-3xl p-5 mb-4 card-shadow-lg border-2 border-yellow-400 relative">
                <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-yellow-400 text-yellow-900 px-4 py-1 rounded-full text-xs font-bold">
                    BEST VALUE
                </div>
                <div class="flex items-center justify-between mb-3 mt-2">
                    <div>
                        <h3 class="text-lg font-bold primary-green mb-1">Annual</h3>
                        <p class="text-sm text-gray-500">Save 17% with yearly plan</p>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-bold primary-green">€99.99</div>
                        <div class="text-xs text-gray-500">€8.33/month</div>
                    </div>
                </div>
                <div class="bg-yellow-50 rounded-xl p-3 mb-4">
                    <div class="text-xs text-yellow-700 font-medium">
                        <i class="fas fa-gift mr-1"></i>Save €19.89 compared to monthly
                    </div>
                </div>
                <div class="space-y-2 mb-4">
                    <div class="flex items-center text-sm text-gray-700">
                        <i class="fas fa-check-circle text-green-500 mr-2"></i>
                        <span>All Quarterly benefits included</span>
                    </div>
                    <div class="flex items-center text-sm text-gray-700">
                        <i class="fas fa-check-circle text-green-500 mr-2"></i>
                        <span>25% discount on all stations</span>
                    </div>
                    <div class="flex items-center text-sm text-gray-700">
                        <i class="fas fa-check-circle text-green-500 mr-2"></i>
                        <span>Free premium support</span>
                    </div>
                    <div class="flex items-center text-sm text-gray-700">
                        <i class="fas fa-check-circle text-green-500 mr-2"></i>
                        <span>Exclusive annual member badge</span>
                    </div>
                    <div class="flex items-center text-sm text-gray-700">
                        <i class="fas fa-check-circle text-green-500 mr-2"></i>
                        <span>2 free months included</span>
                    </div>
                </div>
                <button class="w-full gradient-bg text-white py-3 rounded-2xl font-bold card-shadow hover:opacity-90 transition-opacity">
                    Subscribe Annually
                </button>
            </div>
        </div>

        <!-- Features Comparison -->
        <div class="mx-4 mt-6 mb-6">
            <h2 class="text-lg font-bold primary-green mb-4" style="font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;">What's Included</h2>
            <div class="bg-white rounded-3xl p-5 card-shadow-lg">
                <div class="space-y-3">
                    <div class="flex items-start">
                        <i class="fas fa-bolt text-yellow-500 mt-1 mr-3"></i>
                        <div>
                            <div class="font-medium text-sm mb-1">Unlimited Charging</div>
                            <div class="text-xs text-gray-500">Charge your e-bike as many times as you need</div>
                        </div>
                    </div>
                    <div class="flex items-start">
                        <i class="fas fa-percent text-green-500 mt-1 mr-3"></i>
                        <div>
                            <div class="font-medium text-sm mb-1">Exclusive Discounts</div>
                            <div class="text-xs text-gray-500">Save on every charging session</div>
                        </div>
                    </div>
                    <div class="flex items-start">
                        <i class="fas fa-headset text-blue-500 mt-1 mr-3"></i>
                        <div>
                            <div class="font-medium text-sm mb-1">Priority Support</div>
                            <div class="text-xs text-gray-500">Get help faster with dedicated support</div>
                        </div>
                    </div>
                    <div class="flex items-start">
                        <i class="fas fa-leaf text-green-500 mt-1 mr-3"></i>
                        <div>
                            <div class="font-medium text-sm mb-1">Eco Impact Tracking</div>
                            <div class="text-xs text-gray-500">Monitor your environmental contribution</div>
                        </div>
                    </div>
                    <div class="flex items-start">
                        <i class="fas fa-star text-purple-500 mt-1 mr-3"></i>
                        <div>
                            <div class="font-medium text-sm mb-1">Member Rewards</div>
                            <div class="text-xs text-gray-500">Earn points and unlock exclusive benefits</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Payment Info -->
        <div class="mx-4 mb-6">
            <div class="bg-gray-50 rounded-2xl p-4">
                <div class="flex items-center gap-2 mb-2">
                    <i class="fas fa-shield-alt text-green-600"></i>
                    <span class="text-sm font-medium">Secure Payment</span>
                </div>
                <p class="text-xs text-gray-600">
                    All payments are processed securely. You can cancel your subscription at any time. 
                    Subscriptions automatically renew unless cancelled.
                </p>
            </div>
        </div>
    </div>

    <!-- Subscription Confirmation Modal -->
    <div id="subscribeModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center px-4" onclick="if(event.target === this) closeSubscribeModal()">
        <div class="bg-white rounded-3xl p-6 max-w-sm w-full card-shadow-lg transform transition-all duration-300 scale-95 opacity-0" id="subscribeModalContent" onclick="event.stopPropagation()">
            <div class="text-center mb-6">
                <div class="w-16 h-16 mx-auto mb-4 gradient-bg rounded-full flex items-center justify-center">
                    <i class="fas fa-check text-white text-2xl"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-800 mb-2">Confirm Subscription</h3>
                <p class="text-sm text-gray-600" id="subscribeModalTitle">Are you sure you want to subscribe to this plan?</p>
                <div class="mt-4 p-3 bg-green-50 rounded-xl" id="subscribeModalDetails">
                    <p class="text-xs text-gray-600" id="subscribeModalPrice"></p>
                </div>
            </div>
            <div class="flex gap-3">
                <button class="flex-1 border-2 border-gray-300 text-gray-700 py-3 rounded-2xl font-bold text-sm hover:bg-gray-50 transition-colors" onclick="closeSubscribeModal()">
                    Cancel
                </button>
                <button class="flex-1 gradient-bg text-white py-3 rounded-2xl font-bold text-sm card-shadow hover:opacity-90 transition-opacity" id="confirmSubscribeBtn">
                    Confirm
                </button>
            </div>
        </div>
    </div>

    <!-- Success Toast -->
    <div id="successToast" class="fixed top-20 left-1/2 transform -translate-x-1/2 bg-white rounded-2xl px-6 py-4 card-shadow-lg z-50 hidden items-center gap-3 max-w-sm w-full mx-4">
        <div class="w-10 h-10 gradient-bg rounded-full flex items-center justify-center flex-shrink-0">
            <i class="fas fa-check text-white"></i>
        </div>
        <div class="flex-1">
            <div class="font-bold text-sm text-gray-800">Success!</div>
            <div class="text-xs text-gray-600" id="successToastMessage">Your subscription has been activated</div>
        </div>
        <button onclick="closeSuccessToast()" class="text-gray-400 hover:text-gray-600">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <script>
        // Detect if in iframe, hide bottom navigation if so
        if (window.self !== window.top) {
            // Navigation is handled by parent frame
        }

        // Store current selected subscription plan
        let currentSubscribePlan = null;

        // Show subscription confirmation modal
        function showSubscribeModal(planType, price, period) {
            currentSubscribePlan = { planType, price, period };
            
            // Update modal content
            const titleMap = {
                'Monthly': 'Monthly Plan',
                'Quarterly': 'Quarterly Plan',
                'Annual': 'Annual Plan'
            };
            
            document.getElementById('subscribeModalTitle').textContent = `Are you sure you want to subscribe to the ${titleMap[planType]}?`;
            document.getElementById('subscribeModalPrice').textContent = `${price} / ${period}`;
            
            // Show modal
            const modal = document.getElementById('subscribeModal');
            const modalContent = document.getElementById('subscribeModalContent');
            modal.classList.remove('hidden');
            setTimeout(() => {
                modalContent.classList.remove('scale-95', 'opacity-0');
                modalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        // Confirm subscription
        function confirmSubscribe() {
            if (!currentSubscribePlan) return;

            const { planType, price } = currentSubscribePlan;
            
            // Calculate new expiration date
            const newExpirationDate = calculateNewExpirationDate(planType);
            
            // Save subscription info to localStorage
            const subscriptionInfo = {
                planType: planType,
                expirationDate: newExpirationDate,
                subscribedAt: new Date().toISOString()
            };
            localStorage.setItem('subscriptionInfo', JSON.stringify(subscriptionInfo));
            
            // Update current subscription status display
            updateSubscriptionDisplay(newExpirationDate);
            
            // Notify parent window (if in iframe) about subscription update
            if (window.self !== window.top) {
                window.parent.postMessage({
                    type: 'subscriptionUpdated',
                    expirationDate: newExpirationDate
                }, '*');
            }
            
            // Close modal
            closeSubscribeModal();
            
            // Show success message
            showSuccessToast(`${planType} subscription activated! Valid until ${formatDate(newExpirationDate)}`);
            
            currentSubscribePlan = null;
        }

        // Calculate new expiration date based on plan type
        function calculateNewExpirationDate(planType) {
            // Get current expiration date from localStorage or use today's date
            const existingSubscription = JSON.parse(localStorage.getItem('subscriptionInfo') || 'null');
            let baseDate;
            
            if (existingSubscription && existingSubscription.expirationDate) {
                // If there's an existing subscription, extend from expiration date
                baseDate = new Date(existingSubscription.expirationDate);
                // If expiration date is in the past, use today instead
                if (baseDate < new Date()) {
                    baseDate = new Date();
                }
            } else {
                // New subscription, start from today
                baseDate = new Date();
            }
            
            // Add period based on plan type
            const newDate = new Date(baseDate);
            if (planType === 'Monthly') {
                newDate.setMonth(newDate.getMonth() + 1);
            } else if (planType === 'Quarterly') {
                newDate.setMonth(newDate.getMonth() + 3);
            } else if (planType === 'Annual') {
                newDate.setFullYear(newDate.getFullYear() + 1);
            }
            
            return newDate.toISOString().split('T')[0]; // Return YYYY-MM-DD format
        }

        // Format date for display
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toISOString().split('T')[0]; // YYYY-MM-DD format
        }

        // Update subscription display on current page
        function updateSubscriptionDisplay(expirationDate) {
            // Update current subscription status card
            const validUntilElement = document.getElementById('currentExpirationDate');
            if (validUntilElement) {
                validUntilElement.textContent = expirationDate;
            }
        }

        // Close subscription modal
        function closeSubscribeModal() {
            const modal = document.getElementById('subscribeModal');
            const modalContent = document.getElementById('subscribeModalContent');
            modalContent.classList.remove('scale-100', 'opacity-100');
            modalContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
            currentSubscribePlan = null;
        }

        // Show success toast
        function showSuccessToast(message) {
            const toast = document.getElementById('successToast');
            const toastMessage = document.getElementById('successToastMessage');
            toastMessage.textContent = message;
            
            toast.classList.remove('hidden');
            toast.classList.add('flex');
            
            // Auto close after 3 seconds
            setTimeout(() => {
                closeSuccessToast();
            }, 3000);
        }

        // Close success toast
        function closeSuccessToast() {
            const toast = document.getElementById('successToast');
            toast.classList.add('hidden');
            toast.classList.remove('flex');
        }

        // Load and display current subscription info
        function loadSubscriptionInfo() {
            const subscriptionInfo = JSON.parse(localStorage.getItem('subscriptionInfo') || 'null');
            if (subscriptionInfo && subscriptionInfo.expirationDate) {
                const expirationElement = document.getElementById('currentExpirationDate');
                if (expirationElement) {
                    expirationElement.textContent = subscriptionInfo.expirationDate;
                }
            }
        }

        // Bind confirm button
        document.addEventListener('DOMContentLoaded', function() {
            const confirmBtn = document.getElementById('confirmSubscribeBtn');
            if (confirmBtn) {
                confirmBtn.addEventListener('click', confirmSubscribe);
            }
            // Load subscription info on page load
            loadSubscriptionInfo();
        });

        // Handle subscription button clicks
        document.querySelectorAll('button').forEach(button => {
            if (button.textContent.includes('Subscribe')) {
                button.addEventListener('click', function() {
                    const planType = this.textContent.includes('Monthly') ? 'Monthly' : 
                                   this.textContent.includes('Quarterly') ? 'Quarterly' : 'Annual';
                    
                    // Get price information
                    const card = this.closest('.bg-white');
                    const priceElement = card.querySelector('.text-2xl.font-bold');
                    const price = priceElement ? priceElement.textContent : '';
                    const period = planType === 'Monthly' ? 'month' : 
                                  planType === 'Quarterly' ? '3 months' : 'year';
                    
                    showSubscribeModal(planType, price, period);
                });
            }
        });
    </script>
</body>
</html>

