<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>My Activities - SolarRide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="custom.css">
</head>
<body class="bg-gradient-to-b from-green-50 to-emerald-50">
    <!-- Top Navigation -->
    <div class="bg-white/95 backdrop-blur-md safe-area-top border-b border-gray-100/50 shadow-sm">
        <div class="flex items-center justify-between px-4 py-3.5">
            <button class="w-10 h-10 flex items-center justify-center" onclick="window.parent.postMessage({type: 'navigate', page: 'friends'}, '*')">
                <i class="fas fa-arrow-left text-gray-700"></i>
            </button>
            <h1 class="text-lg font-bold primary-green" style="font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;">My Activities</h1>
            <div class="w-10"></div>
        </div>
    </div>

    <!-- Content Area -->
    <div class="pb-6 custom-scrollbar overflow-y-auto" style="height: calc(100vh - 60px);">
        <!-- Activities List -->
        <div id="activitiesList" class="px-4 mt-4 space-y-4">
            <!-- Activities will be loaded here -->
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="px-4 mt-12 text-center hidden">
            <div class="w-24 h-24 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center">
                <i class="fas fa-calendar-check text-gray-400 text-4xl"></i>
            </div>
            <h3 class="text-lg font-bold text-gray-700 mb-2">No Activities Yet</h3>
            <p class="text-sm text-gray-500 mb-6">Join activities from the Riders page to see them here</p>
            <button class="gradient-bg text-white px-6 py-3 rounded-2xl font-bold" onclick="window.parent.postMessage({type: 'navigate', page: 'friends'}, '*')">
                Browse Activities
            </button>
        </div>
    </div>

    <!-- Custom Modal for Leave Confirmation -->
    <div id="leaveModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center px-4" onclick="if(event.target === this) closeLeaveModal()">
        <div class="bg-white rounded-3xl p-6 max-w-sm w-full card-shadow-lg transform transition-all duration-300 scale-95 opacity-0" id="leaveModalContent" onclick="event.stopPropagation()">
            <div class="text-center mb-6">
                <div class="w-16 h-16 mx-auto mb-4 bg-red-100 rounded-full flex items-center justify-center">
                    <i class="fas fa-exclamation-triangle text-red-500 text-2xl"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-800 mb-2">Leave Activity?</h3>
                <p class="text-sm text-gray-600" id="leaveModalTitle">Are you sure you want to leave this activity?</p>
            </div>
            <div class="flex gap-3">
                <button class="flex-1 border-2 border-gray-300 text-gray-700 py-3 rounded-2xl font-bold text-sm hover:bg-gray-50 transition-colors" onclick="closeLeaveModal()">
                    Cancel
                </button>
                <button class="flex-1 bg-red-500 text-white py-3 rounded-2xl font-bold text-sm card-shadow hover:bg-red-600 transition-colors" id="confirmLeaveBtn">
                    Leave
                </button>
            </div>
        </div>
    </div>

    <script>
        // Load activities from localStorage
        function loadMyActivities() {
            const activities = JSON.parse(localStorage.getItem('myActivities') || '[]');
            const activitiesList = document.getElementById('activitiesList');
            const emptyState = document.getElementById('emptyState');

            if (activities.length === 0) {
                activitiesList.classList.add('hidden');
                emptyState.classList.remove('hidden');
                return;
            }

            activitiesList.classList.remove('hidden');
            emptyState.classList.add('hidden');
            activitiesList.innerHTML = '';

            activities.forEach((activity, index) => {
                const activityCard = createActivityCard(activity, index);
                activitiesList.appendChild(activityCard);
            });
        }

        // Create activity card
        function createActivityCard(activity, index) {
            const card = document.createElement('div');
            card.className = 'bg-white rounded-3xl overflow-hidden card-shadow-lg';
            
            const tagsHtml = activity.tags.map(tag => {
                const colorClass = tag === 'Group Ride' ? 'gradient-bg-green text-green-700' :
                                  tag === 'Eco Commute' ? 'gradient-bg-yellow text-yellow-700' :
                                  tag === 'Charge Together' ? 'bg-blue-100 text-blue-700' :
                                  tag === 'Coffee Time' ? 'bg-purple-100 text-purple-700' :
                                  tag === 'Night Ride' ? 'bg-gray-100 text-gray-700' : 
                                  'gradient-bg-green text-green-700';
                return `<span class="px-3 py-1.5 ${colorClass} rounded-full text-xs font-medium">${tag}</span>`;
            }).join('');

            card.innerHTML = `
                <div class="h-40 image-placeholder relative">
                    <img src="${activity.image}" alt="${activity.title}" class="w-full h-full object-cover">
                    <div class="absolute top-4 right-4">
                        <span class="px-3 py-1.5 gradient-bg text-white rounded-full text-xs font-bold">Joined</span>
                    </div>
                </div>
                <div class="p-5">
                    <div class="flex items-center gap-2 mb-2">
                        ${tagsHtml}
                    </div>
                    <h3 class="font-bold text-lg mb-2 primary-green" style="font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;">${activity.title}</h3>
                    <div class="flex items-center gap-4 text-sm text-gray-500 mb-3">
                        ${activity.date ? `<span><i class="far fa-calendar"></i> ${activity.date}</span>` : ''}
                        ${activity.distance ? `<span><i class="fas fa-route"></i> ${activity.distance}</span>` : ''}
                        ${activity.location ? `<span><i class="fas fa-map-marker-alt"></i> ${activity.location}</span>` : ''}
                    </div>
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <div class="flex -space-x-2">
                                ${Array(Math.min(activity.joined, 4)).fill(0).map((_, i) => {
                                    const bgColors = [
                                        'bg-green-200', 'bg-blue-200', 'bg-yellow-200', 
                                        'bg-pink-200', 'bg-purple-200', 'bg-red-200', 'bg-orange-200'
                                    ];
                                    return `<div class="w-8 h-8 ${bgColors[i % bgColors.length]} rounded-full border-2 border-white"></div>`;
                                }).join('')}
                            </div>
                            <span class="text-sm text-gray-600">${activity.joined}/${activity.total} joined</span>
                        </div>
                        <button class="border-2 border-red-500 text-red-500 px-5 py-2.5 rounded-2xl text-sm font-bold hover:bg-red-50 transition-colors" onclick="showLeaveModal(${index})" type="button">
                            Leave
                        </button>
                    </div>
                </div>
            `;
            
            return card;
        }

        // Store current activity index for leave confirmation
        let currentLeaveIndex = null;

        // Show leave confirmation modal
        function showLeaveModal(index) {
            const activities = JSON.parse(localStorage.getItem('myActivities') || '[]');
            if (index >= activities.length) return;

            currentLeaveIndex = index;
            const activity = activities[index];
            
            // Update modal content
            document.getElementById('leaveModalTitle').textContent = `Are you sure you want to leave "${activity.title}"?`;
            
            // Show modal
            const modal = document.getElementById('leaveModal');
            const modalContent = document.getElementById('leaveModalContent');
            modal.classList.remove('hidden');
            setTimeout(() => {
                modalContent.classList.remove('scale-95', 'opacity-0');
                modalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        // Confirm leave
        function confirmLeave() {
            if (currentLeaveIndex === null) return;

            const activities = JSON.parse(localStorage.getItem('myActivities') || '[]');
            activities.splice(currentLeaveIndex, 1);
            localStorage.setItem('myActivities', JSON.stringify(activities));
            
            closeLeaveModal();
            loadMyActivities();
        }

        // Close leave modal
        function closeLeaveModal() {
            const modal = document.getElementById('leaveModal');
            const modalContent = document.getElementById('leaveModalContent');
            modalContent.classList.remove('scale-100', 'opacity-100');
            modalContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
            currentLeaveIndex = null;
        }

        // Bind confirm button
        document.addEventListener('DOMContentLoaded', function() {
            const confirmBtn = document.getElementById('confirmLeaveBtn');
            if (confirmBtn) {
                confirmBtn.addEventListener('click', confirmLeave);
            }
        });

        // Initialize
        loadMyActivities();

        // Listen for new activities
        window.addEventListener('storage', function(e) {
            if (e.key === 'myActivities') {
                loadMyActivities();
            }
        });

        // Detect if in iframe
        if (window.self !== window.top) {
            // Navigation is handled by parent frame
        }
    </script>
</body>
</html>

