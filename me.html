<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Me - SolarRide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="custom.css">
</head>
<body class="bg-gradient-to-b from-green-50 to-emerald-50">
    <!-- 顶部个人信息 -->
    <div class="gradient-bg text-white safe-area-top pb-6">
        <div class="px-4 pt-4">
            <div class="flex items-center justify-between mb-4">
                <h1 class="text-xl font-bold">Me</h1>
                <button class="w-10 h-10 flex items-center justify-center">
                    <i class="fas fa-cog text-white"></i>
                </button>
            </div>
            <div class="flex items-center gap-4">
                <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center backdrop-blur">
                    <i class="fas fa-user text-2xl"></i>
                </div>
                <div class="flex-1">
                    <div class="text-lg font-bold mb-1">Rider</div>
                    <div class="text-sm opacity-90">00001</div>
                </div>
                <div class="text-right">
                    <div class="text-xs opacity-75 mb-1">Member</div>
                    <div class="px-3 py-1.5 gradient-bg-yellow text-yellow-900 rounded-full text-xs font-bold">Green Member</div>
                </div>
            </div>
        </div>
    </div>

    <!-- 内容区 -->
    <div class="pb-20 custom-scrollbar overflow-y-auto -mt-4" style="height: calc(100vh - 180px);">
        <!-- 我的车辆 -->
        <div class="mx-4 mt-4 bg-white rounded-3xl p-5 card-shadow-lg">
            <div class="flex items-center justify-between mb-4">
                <h2 class="font-bold primary-green" style="font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;">My Vehicle</h2>
                <button class="text-sm primary-green">
                    <i class="fas fa-plus mr-1"></i>Add
                </button>
            </div>
            <div class="flex items-center gap-4">
                <div class="w-16 h-16 gradient-bg-green rounded-2xl flex items-center justify-center">
                    <i class="fas fa-bicycle text-2xl text-green-700"></i>
                </div>
                <div class="flex-1">
                    <div class="font-bold primary-green mb-1" style="font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;">E-Bike N1S</div>
                    <div class="text-sm text-gray-500">Battery 26Ah</div>
                </div>
                <div class="text-right">
                    <div class="text-2xl font-bold primary-green mb-1" style="font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;">70%</div>
                    <div class="text-xs text-gray-500">Battery</div>
                </div>
            </div>
        </div>

        <!-- 快捷功能 -->
        <div class="mx-4 mt-4 bg-white rounded-3xl p-5 card-shadow-lg">
            <div class="grid grid-cols-4 gap-4 text-center">
                <div>
                    <div class="w-12 h-12 gradient-bg-green rounded-2xl flex items-center justify-center mx-auto mb-2">
                        <i class="fas fa-history text-green-700"></i>
                    </div>
                    <div class="text-xs text-gray-600">Charging History</div>
                </div>
                <div>
                    <div class="w-12 h-12 gradient-bg-yellow rounded-2xl flex items-center justify-center mx-auto mb-2">
                        <i class="fas fa-ticket-alt text-yellow-700"></i>
                    </div>
                    <div class="text-xs text-gray-600">Coupons</div>
                </div>
                <div>
                    <div class="w-12 h-12 gradient-bg rounded-2xl flex items-center justify-center mx-auto mb-2">
                        <i class="fas fa-store text-white"></i>
                    </div>
                    <div class="text-xs text-gray-600">Merchant Benefits</div>
                </div>
                <div>
                    <div class="w-12 h-12 gradient-bg-purple rounded-2xl flex items-center justify-center mx-auto mb-2">
                        <i class="fas fa-leaf text-purple-700"></i>
                    </div>
                    <div class="text-xs text-gray-600">Eco Impact</div>
                </div>
            </div>
        </div>

        <!-- 会员订阅 -->
        <div class="mx-4 mt-4 gradient-bg-purple rounded-3xl p-5 card-shadow-lg">
            <div class="flex items-center justify-between">
                <div>
                    <div class="text-purple-900 font-bold mb-1">Green Energy Member</div>
                    <div class="text-purple-700 text-sm" id="subscriptionExpirationDate">Valid until 2024-12-31</div>
                </div>
                <button class="bg-white text-purple-700 px-5 py-2.5 rounded-2xl font-bold text-sm card-shadow hover:opacity-90 transition-opacity" onclick="showRenewModal()">
                    Renew
                </button>
            </div>
        </div>

        <!-- 环保成就 -->
        <div class="mx-4 mt-4 bg-white rounded-3xl p-5 card-shadow-lg">
            <div class="flex items-center justify-between mb-4">
                <h2 class="font-bold primary-green" style="font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;">Eco Impact</h2>
                <!-- <span class="text-sm primary-green">View Details <i class="fas fa-chevron-right text-xs"></i></span> -->
            </div>
            <div class="grid grid-cols-3 gap-4">
                <div class="text-center p-4 gradient-bg-green rounded-2xl">
                    <div class="text-xl font-bold text-green-700 mb-1">125</div>
                    <div class="text-xs text-gray-600">CO₂ Reduced (kg)</div>
                </div>
                <div class="text-center p-4 gradient-bg-yellow rounded-2xl">
                    <div class="text-xl font-bold text-yellow-700 mb-1">85%</div>
                    <div class="text-xs text-gray-600">Solar Powered</div>
                </div>
                <div class="text-center p-4 gradient-bg rounded-2xl">
                    <div class="text-xl font-bold text-white mb-1">68</div>
                    <div class="text-xs text-white/80">Charging Sessions</div>
                </div>
            </div>
        </div>

        <!-- 其他功能 -->
        <div class="mx-4 mt-4 bg-white rounded-3xl overflow-hidden card-shadow-lg">
            <div class="flex items-center justify-between p-4 border-b border-gray-100 cursor-pointer" onclick="window.parent.postMessage({type: 'navigate', page: 'subscription'}, '*')">
                <div class="flex items-center gap-3">
                    <i class="fas fa-crown primary-green"></i>
                    <span class="font-medium primary-green">Subscription Center</span>
                </div>
                <i class="fas fa-chevron-right text-gray-400"></i>
            </div>
            <!-- <div class="flex items-center justify-between p-4 border-b border-gray-100"> -->
                <!-- <div class="flex items-center gap-3">
                    <i class="fas fa-heart text-red-500"></i>
                    <span class="font-medium">My Favorites</span>
                </div> -->
                <!-- <i class="fas fa-chevron-right text-gray-400"></i> -->
            <!-- </div> -->
            <div class="flex items-center justify-between p-4 border-b border-gray-100">
                <div class="flex items-center gap-3">
                    <i class="fas fa-headset primary-green"></i>
                    <span class="font-medium">Help & Feedback</span>
                </div>
                <i class="fas fa-chevron-right text-gray-400"></i>
            </div>
            <div class="flex items-center justify-between p-4">
                <div class="flex items-center gap-3">
                    <i class="fas fa-info-circle text-gray-500"></i>
                    <span class="font-medium">About SolarRide</span>
                </div>
                <i class="fas fa-chevron-right text-gray-400"></i>
            </div>
        </div>
    </div>

    <!-- 底部导航 -->
    <div class="fixed bottom-0 left-0 right-0 bottom-nav safe-area-bottom" id="subBottomNav">
        <div class="flex items-center justify-around py-2">
            <div class="flex flex-col items-center py-2">
                <i class="fas fa-home text-gray-400 text-xl mb-1"></i>
                <span class="text-xs text-gray-400">Home</span>
            </div>
            <div class="flex flex-col items-center py-2">
                <i class="fas fa-map text-gray-400 text-xl mb-1"></i>
                <span class="text-xs text-gray-400">Map</span>
            </div>
            <div class="nav-center-btn">
                <i class="fas fa-qrcode text-white text-xl"></i>
            </div>
            <div class="flex flex-col items-center py-2">
                <i class="fas fa-users text-gray-400 text-xl mb-1"></i>
                <span class="text-xs text-gray-400">Riders</span>
            </div>
            <div class="flex flex-col items-center py-2">
                <i class="fas fa-user primary-green text-xl mb-1"></i>
                <span class="text-xs primary-green font-medium">Me</span>
            </div>
        </div>
    </div>

    <!-- Renew Subscription Confirmation Modal -->
    <div id="renewModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center px-4" onclick="if(event.target === this) closeRenewModal()">
        <div class="bg-white rounded-3xl p-6 max-w-sm w-full card-shadow-lg transform transition-all duration-300 scale-95 opacity-0" id="renewModalContent" onclick="event.stopPropagation()">
            <div class="text-center mb-6">
                <div class="w-16 h-16 mx-auto mb-4 gradient-bg rounded-full flex items-center justify-center">
                    <i class="fas fa-sync-alt text-white text-2xl"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-800 mb-2">Renew Subscription</h3>
                <p class="text-sm text-gray-600" id="renewModalTitle">Your subscription expires on 2024-12-31. Would you like to renew it now?</p>
                <div class="mt-4 p-3 bg-purple-50 rounded-xl">
                    <p class="text-xs text-purple-700 font-medium">
                        <i class="fas fa-info-circle mr-1"></i>Renewing will extend your membership for another period
                    </p>
                </div>
            </div>
            <div class="flex gap-3">
                <button class="flex-1 border-2 border-gray-300 text-gray-700 py-3 rounded-2xl font-bold text-sm hover:bg-gray-50 transition-colors" onclick="closeRenewModal()">
                    Cancel
                </button>
                <button class="flex-1 gradient-bg text-white py-3 rounded-2xl font-bold text-sm card-shadow hover:opacity-90 transition-opacity" id="confirmRenewBtn">
                    Renew Now
                </button>
            </div>
        </div>
    </div>

    <!-- Success Toast -->
    <div id="successToast" class="fixed top-20 left-1/2 transform -translate-x-1/2 bg-white rounded-2xl px-6 py-4 card-shadow-lg z-50 hidden items-center gap-3 max-w-sm w-full mx-4">
        <div class="w-10 h-10 gradient-bg rounded-full flex items-center justify-center flex-shrink-0">
            <i class="fas fa-check text-white"></i>
        </div>
        <div class="flex-1">
            <div class="font-bold text-sm text-gray-800">Success!</div>
            <div class="text-xs text-gray-600" id="successToastMessage">Subscription renewed successfully</div>
        </div>
        <button onclick="closeSuccessToast()" class="text-gray-400 hover:text-gray-600">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <script>
        // Detect if in iframe, hide bottom navigation if so
        if (window.self !== window.top) {
            const bottomNav = document.getElementById('subBottomNav');
            if (bottomNav) {
                bottomNav.style.display = 'none';
            }
        }

        // Load and display subscription expiration date
        function loadSubscriptionExpiration() {
            const subscriptionInfo = JSON.parse(localStorage.getItem('subscriptionInfo') || 'null');
            if (subscriptionInfo && subscriptionInfo.expirationDate) {
                const expirationElement = document.getElementById('subscriptionExpirationDate');
                if (expirationElement) {
                    expirationElement.textContent = `Valid until ${subscriptionInfo.expirationDate}`;
                }
            }
        }

        // Listen for subscription updates from localStorage
        window.addEventListener('storage', function(e) {
            if (e.key === 'subscriptionInfo') {
                loadSubscriptionExpiration();
            }
        });

        // Listen for subscription updates from parent window (if in iframe)
        if (window.self !== window.top) {
            window.addEventListener('message', function(event) {
                if (event.data && event.data.type === 'subscriptionUpdated') {
                    loadSubscriptionExpiration();
                }
            });
        }

        // Load subscription info on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadSubscriptionExpiration();
        });

        // Show renew subscription modal
        function showRenewModal() {
            // Get current expiration date from localStorage or page
            const subscriptionInfo = JSON.parse(localStorage.getItem('subscriptionInfo') || 'null');
            let expirationDate = '2024-12-31';
            
            if (subscriptionInfo && subscriptionInfo.expirationDate) {
                expirationDate = subscriptionInfo.expirationDate;
            } else {
                // Fallback to page content
                const expirationElement = document.getElementById('subscriptionExpirationDate');
                if (expirationElement) {
                    expirationDate = expirationElement.textContent.replace('Valid until ', '');
                }
            }
            
            // Update modal content
            document.getElementById('renewModalTitle').textContent = `Your subscription expires on ${expirationDate}. Would you like to renew it now?`;
            
            // Show modal
            const modal = document.getElementById('renewModal');
            const modalContent = document.getElementById('renewModalContent');
            modal.classList.remove('hidden');
            setTimeout(() => {
                modalContent.classList.remove('scale-95', 'opacity-0');
                modalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        // Confirm renew subscription
        function confirmRenew() {
            // Close modal
            closeRenewModal();
            
            // Navigate to subscription page
            if (window.self !== window.top) {
                // If in iframe, send message to parent
                window.parent.postMessage({type: 'navigate', page: 'subscription'}, '*');
            } else {
                // If standalone, navigate directly
                window.location.href = 'subscription.html';
            }
            
            // Show success message after a short delay
            setTimeout(() => {
                showSuccessToast('Redirecting to subscription center...');
            }, 500);
        }

        // Close renew modal
        function closeRenewModal() {
            const modal = document.getElementById('renewModal');
            const modalContent = document.getElementById('renewModalContent');
            modalContent.classList.remove('scale-100', 'opacity-100');
            modalContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        // Show success toast
        function showSuccessToast(message) {
            const toast = document.getElementById('successToast');
            const toastMessage = document.getElementById('successToastMessage');
            toastMessage.textContent = message;
            
            toast.classList.remove('hidden');
            toast.classList.add('flex');
            
            // Auto close after 3 seconds
            setTimeout(() => {
                closeSuccessToast();
            }, 3000);
        }

        // Close success toast
        function closeSuccessToast() {
            const toast = document.getElementById('successToast');
            toast.classList.add('hidden');
            toast.classList.remove('flex');
        }

        // Bind confirm button
        document.addEventListener('DOMContentLoaded', function() {
            const confirmBtn = document.getElementById('confirmRenewBtn');
            if (confirmBtn) {
                confirmBtn.addEventListener('click', confirmRenew);
            }
        });
    </script>
</body>
</html>
